<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Pose Me!</title>

        <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
        <!--<script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js"></script>-->
        <script src="https://rawgit.com/mayognaise/aframe-mouse-cursor-component/master/dist/aframe-mouse-cursor-component.min.js"></script>
        <script src="https://unpkg.com/aframe-render-order-component@1.1.0/dist/aframe-render-order-component.min.js"></script>
        <script src="./js/lookAt.js"></script>
        
        <script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js"></script>
        
        <script src="./js/poseMe.js"></script>
        <script src="./js/targetCircles.js"></script>
        <script src="./js/window.js"></script>
        <link rel="stylesheet" href="./styles/style.css" />
    </head>
    <body>
        <!--a
        <div id="instructions">                    
            Lock your phone in landscape mode.<br>
            Rotate your bubble to match the falling bubbles<br>
            Don't let the bubbles hit the ground. 3 lives and you're out!<br>
            <button id="startButton">Start</button>
        </div>
        -->

        <a-scene
            id="game"
            pose-me
            cursor="rayOrigin:mouse"
            render-order="cursor, bubbles, hitbox">
            <a-assets>
                <img src="./assets/bubblePerson.png" id="bubble" />
                <img src="./assets/bubblePx.png" id="bubbleCursor" />
                <img src="./assets/ANDYBTTF.png" id="andybttf" />
            <a-assets-item src="./assets/pop.mp3" id="pop" />
            <a-assets-item
                    src="https://cdn.glitch.global/0ffb2b61-172a-4b40-8f0c-6a963c789cb6/bach.mp3?v=1716602360835"
                    id="bkgd" />
            </a-assets>


            <a-sound
                id="popSound"
                sound="src:#pop; autoplay:false; volume:0.80; loop:false; positional:true;"></a-sound>
            <a-sound
                id="bkgdSound"
                sound="src:#bkgd; autoplay:true; volume:1; loop:true;positional:false;"></a-sound>

            <!--
            <a-plane
                id="instructions"
                color="#FFFF00"
                position="0 0 -3"
                width="5"
                height="8"></a-plane>
                -->

            <a-plane
                position="2 0.80503 -3.92"
                rotation="0 0 0"
                color="#6495ED"
                look-at></a-plane>
            <a-plane
                position="3 0.80503 -3.92"
                rotation="0 0 0"
                color="#6495ED"
                look-at></a-plane>
            <a-plane
                position="4 0.80503 -3.92"
                rotation="0 0 0"
                color="#6495ED"
                look-at></a-plane>
            <a-plane
                position="5 0.80503 -3.92"
                rotation="0 0 0"
                color="#6495ED"
                look-at></a-plane>
            <a-plane
                set-color="#008899"
                position="0 0 0"
                color="#802020"
                rotation="-90 0 0"
                scale="50 50 1"></a-plane>

            <a-sky color="#202030"></a-sky>

            <a-camera
                position="0 1.5 0"
                id="cam"
                mouse-cursor
                wasd-controls-enabled="true"
                renderer="sortObjects: true; sortTransparentObjects: true">
                <a-cursor raycaster="objects:.poseMeTarget">
                    <a-text
                        id="score"
                        value="Score: 0"
                        position="0 -0.91 -1"
                        font="./assets/ANDYB-msdf.json"
                        fontimage="#andybttf"
                        align="center"
                        negate="false"></a-text>
                    <a-text
                        id="lives"
                        value="Lives: 0"
                        position="-0.74 -1.155 -1"
                        width="2.9"
                        font="./assets/ANDYB-msdf.json"
                        fontimage="#andybttf"
                        align="center"
                        negate="false"></a-text>
                    <a-text
                        id="combo"
                        value="No Combo"
                        position="0 -1.155 -1"
                        width="2.9"
                        font="./assets/ANDYB-msdf.json"
                        fontimage="#andybttf"
                        align="center"
                        negate="false"></a-text>
                    <a-text
                        id="timer"
                        value="Time: 0"
                        position="0.74 -1.155 -1"
                        width="2.9"
                        font="./assets/ANDYB-msdf.json"
                        fontimage="#andybttf"
                        align="center"
                        negate="false"></a-text>
                    <a-circle
                        src="#bubble"
                        transparent="true"
                        material="shader: flat"
                        radius=".5"
                        scale="5.5 5.5 1"
                        position="0 0 -13.5"
                        render-order="cursor">
                    </a-circle>

                    <a-window
                        visible="false"
                        position="0 0 -3"
                        text="value:Everything is awesome!;"></a-window>

                    <a-window
                              
                        id="instructions"
                        position="0 .22 0"
                        text="value:Lock your phone in landscape mode. Then rotate your phone to match the rotation of the falling bubbles. Move your cursor over the bubble and match it's rotation to get a point.;"
                        geometry="width:auto; height:auto;"
                        material="color:#FFFFFF;">
                        <a-box
                            id="closeInstructionsBtn"
                            position="0 -.9 -3"
                            width="1"
                            height=".3"
                            depth=".1"
                               event-set__clickButton="_event:click; material.color:#00aa00">
                            <a-entity
                                position="0 0 .3"
                                text="value:Close;
                            color:#000000;
                            align:center;
                            wrapCount:30;height:15;width:3.4;
                    font:./assets/ANDYB-msdf.json;
                      shader:msdf;
                      negate:false;">
                            </a-entity>
                            </a-box>
                    </a-window>

                    <a-window
                        visible="false"
                        id="gameOver"
                        position="0 .51 0"
                        text="value:Game Over! ...;"
                        geometry="width:auto; height:auto;"
                        material="color:#FFFFFF;"
                              >
                        <a-box
                            id="resetBtn"
                            position="0 0 -3"
                            width="1"
                            height=".3"
                            depth=".2"
                               event-set__gameover="_event:click; material.color:#00aa00">
                            <a-entity
                                position="0 0 .3"
                                text="value:Retry;
                            color:#000000;
                            align:center;
                            wrapCount:30;height:15;width:2.5;
                    font:./assets/ANDYB-msdf.json;
                      shader:msdf;
                      negate:false;">
                            </a-entity>
                        </a-box>
                    </a-window>
                </a-cursor>
            </a-camera>
            <!--<a-entity id="myButton"
                        geometry="primitive: box; width: 2; height: 0.5; depth: 0.1"
                        material="color: #4CC3D9"
                        position="0 1 -3"
                        text="value: Click Me; align: center; width: 4"
                        event-set__mouseenter="_event: mouseenter; color: #64D8FF"
                        event-set__mouseleave="_event: mouseleave; color: #4CC3D9"
                        event-set__click="_event: click; scale: 0.9 0.9 0.9">
              </a-entity>-->
        </a-scene>

        <script>
            //Code for instruction screen
            //let game = document.querySelector("#game");
            //game.hidden = true;
            //
            //let startBtn = document.querySelector("#startButton");
            //startBtn.addEventListener("click", startGame);
            let closeInstructions = document.querySelector("#closeInstructionsBtn");
            closeInstructions.addEventListener("click", startGame);
            
            //setTimeout(startGame, 10000); //5000);

            function startGame(e) {
                closeInstructions.removeEventListener("click", startGame);
                //code to start game
                //let instructions = document.querySelector("#instructions");
                //instructions.hidden = true;
                //game.hidden = false;

                let gameCode =
                    document.querySelector("a-scene").components["pose-me"];
                gameCode.startGame();
            }
            
            this.addEventListener("game-over", ()=>{
                console.log("game over happened");}, true);
            
            
        </script>
    </body>
</html>
